# Changelog

All notable changes to this project will be documented in this file.

The format is based on [Keep a Changelog](https://keepachangelog.com/en/1.0.0/),
and this project adheres to [Semantic Versioning](https://semver.org/spec/v2.0.0.html).

## [7.0.0] - 2025-08-26

### Added

- 🆕 **인과관계 기반 예측(Causal Forecasting)**: '결과'가 아닌 '원인'을 예측하는 새로운 모델 아키텍처
  - 지원자 그룹의 'DNA'(Beta(a,b) 분포) 직접 예측
  - 로버스트 앵커 시스템 대신 beta_a, beta_b 시계열 예측
  - 모델 타입을 "causal_forecast"로 변경

### Changed

- 🔄 **핵심 로직 전면 재설계**: `project_current_year` 함수 완전 재작성

  - 기존: anchor\_\* 컬럼들을 사용하여 미래 결과 지표 예측
  - 새로운: df_fit의 beta_a, beta_b 컬럼 시계열을 직접 예측
  - 복잡한 최적화 과정 제거, 단순하고 안정적인 예측 방식

- 🔄 **UI 개선**:

  - 섹션 제목을 "📝 학과 프로필"로 변경
  - 컬럼 레이아웃 최적화 (2:1, 2:1:2:1)
  - 프로필 파일 저장/불러오기 UI 간소화

- 🔄 **기본 데이터 변경**: 아주대 문화콘텐츠학과 학생부종합ACE로 변경

### Technical Details

- **DNA 예측 로직**: `_recency_weighted_forecast`를 사용하여 beta_a, beta_b 각각 예측
- **폴백 메커니즘**: 예측 실패 시 가장 최근 값 사용, 그래도 없으면 기본값(3.0, 6.0)
- **디버그 패널 간소화**: beta_a, beta_b 중심으로 정보 표시
- **코드 최적화**: to_py_type 함수 로직 간소화

### Fixed

- 🐛 **예측 안정성 문제 해결**: 특정 데이터셋에서 발생하던 비현실적인 예측값 문제 해결
- 🐛 **V자형 트렌드 처리**: 경쟁률 급등으로 인한 최종컷 V자 패턴을 노이즈로 오인하는 문제 해결
- 🐛 **과적합 방지**: 복잡한 앵커 기반 예측 대신 안정적인 DNA 예측으로 전환

### Breaking Changes

- ⚠️ **모델 타입 변경**: "underlying+trunc" → "causal_forecast"
- ⚠️ **예측 방식 변경**: 결과 지표 예측 → 분포 DNA 예측

## [6.2.3] - 2025-08-25

### Added

- 🆕 UI 레이아웃 최적화 (v6.2.3)
  - 입력 폼을 2줄 구조로 재구성하여 화면 공간 효율성 향상
  - 1줄: `|학과명|정원|`
  - 2줄: `|추가충원|입력함|경쟁률|입력함|`

### Changed

- 🔄 입력방식 단순화
  - "입력방식" 선택 드롭다운 제거
  - 경쟁률만 입력 가능하도록 단순화
  - 지원자 수 입력 방식 완전 제거

### Technical Details

- UI 레이아웃을 `st.columns([1, 1])`와 `st.columns([1, 1, 1, 1])`로 2줄 구성
- `ratio_mode` 관련 모든 로직 제거
- `applicants_this_year` 매개변수 제거
- `project_current_year` 함수에서 지원자 수 기반 경쟁률 계산 로직 제거

### Fixed

- 🐛 체크박스 해제 시 값 리셋 로직 개선
  - `on_change` 콜백을 사용하여 StreamlitAPIException 해결
  - `_reset_value_on_uncheck` 헬퍼 함수 추가로 안정적인 상태 관리

## [6.2.2] - 2025-08-25

### Added

- **🆕 UI 레이아웃 최적화**: "올해 입시 정보" 섹션을 한 줄에 배치하여 화면 공간 절약
- **🆕 체크박스 해제 시 값 리셋**: "입력함" 체크박스 해제 시 해당 입력 필드 값을 0으로 자동 리셋

### Features

- **한 줄 레이아웃**: 정원, 입력방식, 추가충원, 경쟁률/지원자수와 각각의 "입력함" 체크박스를 한 줄에 배치
- **자동 값 리셋**: 체크박스 상태 변경 감지 및 입력 필드 값 자동 초기화
- **이전 상태 추적**: 체크박스 상태 변경을 감지하기 위한 `_prev_*` 변수 시스템

### Technical Details

- **컬럼 레이아웃**: 8개 컬럼으로 구성하여 공간 효율성 극대화
- **동적 라벨링**: 입력방식에 따라 경쟁률/지원자수 라벨 동적 변경
- **상태 변경 감지**: `_prev_*` 변수를 통한 체크박스 상태 변경 감지
- **값 리셋 로직**: 체크박스 해제 시 즉시 해당 필드 값을 0으로 리셋

### Fixed

- **🚨 UI 공간 낭비 문제 해결**: 불필요한 세로 공간 제거로 화면 효율성 향상
- **🚨 체크박스 해제 시 값 유지 문제 해결**: 사용자 의도에 맞는 자동 값 리셋 구현

## [6.2.1] - 2025-08-25

### Added

- **🆕 명시적 입력 상태 제어 시스템**: 체크박스로 입력 여부를 명확하게 제어
- **🆕 입력 취소 기능**: 입력한 값을 "입력 안함"으로 되돌릴 수 있는 기능
- **🆕 사용자 의도 명확화**: 실제 0 입력과 정보 미입력을 구분하는 UI

### Features

- **입력 상태 제어**: 추가충원, 경쟁률, 지원자 수에 대한 "입력함" 체크박스 추가
- **필드 활성화/비활성화**: 체크박스 상태에 따른 입력 필드 동적 제어
- **입력 상태 저장**: JSON 프로필에 입력 상태 정보 포함
- **입력 상태 복원**: 저장된 프로필에서 입력 상태 정확하게 복원

### Technical Details

- **입력 상태 추적**: `extra_inputted`, `applicants_inputted`, `ratio_inputted` 플래그
- **자동 추정 로직**: 입력 상태가 False일 때만 자동 추정 수행
- **사용자 입력 보존**: 입력 상태가 True일 때는 0을 포함한 모든 값 보존
- **하위 호환성**: 기존 프로필 파일과의 호환성 유지

### Fixed

- **🚨 0 입력 vs 미입력 구분 불가 문제 해결**: 체크박스로 명확한 구분
- **🚨 입력 변경 추적 불가 문제 해결**: 입력 상태 토글 가능
- **🚨 자동 추정 정확성 문제 해결**: 사용자 의도에 따른 정확한 처리

## [6.2.0] - 2024-12-19

### Added

- 수시 합격 가능성 예측기 Streamlit 앱
- Beta 분포 기반 확률적 모델링
- 과거 데이터 기반 예측 알고리즘
- 시각화 차트 (연도별 추세, 합격 가능성 분포)
- JSON 데이터 저장/불러오기 기능
- 디버그 모드 (전처리/피팅/투영/시뮬 결과 출력)
- **🆕 부분적 데이터 입력 지원**: 모든 값이 없어도 최소 데이터로 예측 가능
- **🆕 자동 추정 시스템**: 경쟁률, 추가충원 등 미입력 시 과거 패턴으로 자동 추정
- **🆕 피팅 모드 자동 선택**: 데이터 상황에 따라 최적 모드 자동 선택

### Features

- **분포 가정**: 전체 지원자 분포를 등급 범위 [1.0, 9.0]에서 Beta(a,b)로 모형화
- **피팅 전략**:
  - 경쟁률/충원 데이터 있는 해: underlying + truncation 방식
  - 경쟁률 없는 해: admitted-only 방식
- **로버스트 앵커**: 입력값 vs 적합치 비교로 anchor\_\* 열 생성
- **올해 투영**: 최근성 가중 회귀로 anchor 시계열 예측
- **시뮬레이션**: N, M 기반으로 최종컷 샘플링 및 합격 확률 계산
- **🆕 부분적 데이터 처리**: 필수값만으로도 예측 실행 가능
- **🆕 자동 추정 엔진**: 경쟁률/추가충원 과거 중앙값 기반 자동 추정
- **🆕 적응형 피팅**: 데이터 상황별 최적 피팅 모드 자동 선택

### Technical Details

- **핵심 정의**: 경쟁률 = 지원자수/정원, 추가충원은 정원 미달분 추가선발
- **선발비율**: q_select = (capacity + extra) / (ratio × capacity)
- **최초합격자 절단비율**: q_init = capacity / M
- **지원자수 계산**: M = ratio × capacity (과거/올해 모두 동일)
- **🆕 자동 추정 로직**: ratio 미입력 시 과거 중앙값, extra 미입력 시 과거 추가충원율 패턴
- **🆕 피팅 모드 분기**: q_select 유무에 따른 underlying+truncation vs admitted-only 자동 선택
- **🆕 부분적 데이터 처리**: 최소 필수값(정원, 과거 컷)만으로도 예측 파이프라인 실행

## [6.1.0] - 2024-12-01

### Added

- 초기 프로토타입 개발
- 기본 수학적 모델링 로직

## [6.0.0] - 2024-11-15

### Added

- 프로젝트 초기 설정
- 기본 아키텍처 설계
