# Contributing to SusiPredict

수시 합격 가능성 예측기 프로젝트에 기여해주셔서 감사합니다! 이 문서는 프로젝트에 기여하는 방법을 안내합니다.

## 🚀 시작하기

### 1. 저장소 포크 및 클론

```bash
# GitHub에서 저장소를 포크한 후
git clone https://github.com/YOUR_USERNAME/SusiPredict.git
cd SusiPredict
```

### 2. 개발 환경 설정

```bash
# 가상환경 생성 (권장)
python -m venv venv
source venv/bin/activate  # Windows: venv\Scripts\activate

# 의존성 설치
pip install -r requirements.txt
pip install -r requirements-dev.txt  # 개발 도구
```

### 3. 개발 브랜치 생성

```bash
git checkout -b feature/your-feature-name
# 또는
git checkout -b fix/your-bug-fix
```

## 🧪 개발 가이드라인

### 코드 스타일

- **Python**: PEP 8 준수
- **포맷팅**: Black 사용 (라인 길이 127자)
- **Import 정렬**: isort 사용
- **린팅**: flake8 사용

### 🔍 부분적 데이터 입력 지원 원칙

**핵심 설계 철학**: 사용자가 모든 정보를 알 필요 없이 최소한의 데이터로도 예측을 수행할 수 있어야 함

#### 📋 필수 vs 선택적 데이터 구분

- **필수 데이터**: 정원(capacity), 지원자 등급, 최소 2년 과거 데이터
- **선택적 데이터**: 경쟁률, 추가충원, 지원자 분포 특성 등
- **자동 추정**: 선택적 데이터가 없을 때 과거 패턴으로 자동 추정

#### 🔧 자동 추정 로직 구현 시 주의사항

1. **과거 데이터 품질 검증**: 극단값이나 이상치가 있는지 확인
2. **추정 신뢰도 표시**: 자동 추정된 값임을 사용자에게 명시
3. **폴백 메커니즘**: 추정이 불가능한 경우 적절한 기본값 사용
4. **사용자 경험**: 추정 과정을 투명하게 보여주고 조정 가능하게 함

## 🆕 명시적 입력 상태 제어 시스템 (v6.2.1+)

### 설계 철학

- **사용자 의도 명확화**: 실제 0 입력과 정보 미입력을 명확히 구분
- **체크박스 기반 제어**: "입력함" 체크박스로 입력 여부를 명시적으로 표시
- **동적 UI 상태**: 체크박스 상태에 따른 입력 필드 활성화/비활성화
- **상태 지속성**: JSON 프로필에 입력 상태 정보 포함하여 저장/복원

### 구현 고려사항

- **세션 상태 관리**: `st.session_state`에 `_inputted` 플래그 추가
- **위젯 상태 동기화**: 체크박스와 입력 필드의 상태 일치성 보장
- **JSON 직렬화**: 입력 상태 정보를 포함한 프로필 저장 구조
- **파이프라인 통합**: 입력 상태에 따른 `None`/값 전달 로직

## 🆕 UI 레이아웃 최적화 (v6.2.2+)

### 설계 원칙

- **공간 효율성**: 화면 공간을 최대한 활용하여 사용성 향상
- **직관적 배치**: 관련 요소들을 논리적으로 그룹화
- **반응형 레이아웃**: 다양한 화면 크기에 적응하는 유연한 배치

### 구현 고려사항

- **컬럼 기반 레이아웃**: `st.columns()`를 활용한 정확한 공간 분할
- **상태 변경 감지**: 체크박스 상태 변경을 통한 자동 값 리셋
- **사용자 경험**: 체크박스 해제 시 즉시 값 리셋으로 의도 명확화

## 🆕 '최근 가중 평균' 예측 방식 (v7.1+)

### 설계 철학

- **비선형적 변동성 처리**: V자형 패턴 등 입시 데이터의 비선형적 특성을 더 잘 반영
- **최신 데이터 우선**: 과거 값들의 평균으로 회귀하면서 최신 데이터에 더 큰 가중치 부여
- **안정성 향상**: 선형 추세 예측의 한계를 극복하여 더 현실적인 예측 제공

## 🆕 '반복적 자가 회복' 메커니즘 (v9.1+)

### 설계 철학

- **의미론적 중요도 기반 변수 제거**: 수학적 오류가 아닌 입시 데이터의 특성을 이해하는 방식으로 변수 제거 우선순위 결정
- **반복적 재시도**: 성공하거나 더 이상 제거할 수 없을 때까지 반복적으로 피팅 시도
- **상세한 실패 진단**: 최종 실패 시 어떤 핵심 변수들이 남아있었는지 구체적으로 보고
- **투명한 데이터 보정**: 어떤 변수가 제거되었는지 사용자에게 명확하게 알림

### 구현 고려사항

- **변수 제거 우선순위**: `REMOVAL_PRIORITY_LIST`로 지원자 데이터(3순위) → 최초합격자 데이터(2순위) → 최종등록자 데이터(1순위) 순서
- **핵심 변수 그룹**: `ESSENTIAL_GROUP_VARS` 내에서 최소 2개만 유지하면 계속 시도
- **실패 진단 정보**: `remaining_vars_on_fail` 컬럼으로 실패 시점의 남은 변수들 추적
- **상태 관리**: `SUCCESS`, `SUCCESS_AFTER_REMOVAL`, `FAILURE` 상태로 피팅 결과 분류

## 🆕 '유연한 중단 규칙' 메커니즘 (v9.0+)

### 설계 철학

- **모델 범용성 향상**: 고정된 필수 변수 목록 대신 유연한 규칙을 적용하여 다양한 데이터 상황에 대응
- **핵심 변수 그룹**: `ESSENTIAL_GROUP_VARS` 내에서 최소 2개만 유지하면 계속 시도
- **지능적 변수 제거**: 핵심 변수가 2개 이하로 남으면 제거 대상에서 자동 제외

### 구현 고려사항

- **전역 설정**: `ESSENTIAL_VARS` → `ESSENTIAL_GROUP_VARS` + `MIN_ESSENTIAL_VARS`로 변경
- **핵심 변수 그룹**: `["median", "p70", "final_cut", "mean", "best"]`
- **최소 유지 개수**: `MIN_ESSENTIAL_VARS = 2`

## 🆕 '2단계 오류 처리' 메커니즘 (v8.0+)

### 설계 철학

- **데이터 품질 자동 진단**: 모델이 데이터의 내부 일관성을 스스로 진단
- **지능적 자가 회복**: 문제가 있을 경우 지능적으로 대처하여 예측 품질 향상
- **사용자 투명성**: 데이터 보정 과정을 명확하게 보고하여 신뢰성 향상

### 구현 고려사항

- **가중치 계산**: alpha(감소 계수)를 이용해 최신 데이터부터 alpha^0, alpha^1, alpha^2... 순으로 가중치 생성
- **기본 alpha 값**: 0.6 (최신 데이터에 더 높은 가중치 부여)
- **변동성 반영**: 과거의 변동성(단순 평균과의 차이)을 통해 불확실성을 반영
- **함수 시그니처 변경**: `_get_stochastic_forecast`에서 `x_new` 파라미터 제거, `n_scenarios` 위치 변경

## 🆕 UI 레이아웃 최적화 (v6.2.3+)

### 설계 원칙

- **균형잡힌 레이아웃**: 가독성과 공간 효율성의 최적 균형
- **단순화된 입력**: 불필요한 복잡성 제거로 사용자 혼란 방지
- **일관된 패턴**: 통일된 UI 패턴으로 사용성 향상

### 구현 고려사항

- **2줄 구조**: `st.columns([1, 1])`와 `st.columns([1, 1, 1, 1])` 조합
- **입력방식 통합**: 경쟁률만 입력 가능하도록 로직 단순화
- **툴팁 최적화**: 필요한 곳에만 적절한 도움말 제공
- **안정적인 상태 관리**: `on_change` 콜백을 사용한 StreamlitAPIException 방지

## 🧪 개발 가이드라인

### 코드 스타일

- **Python**: PEP 8 준수
- **포맷팅**: Black 사용 (라인 길이 127자)
- **Import 정렬**: isort 사용
- **린팅**: flake8 사용

### 🔍 부분적 데이터 입력 지원 원칙

**핵심 설계 철학**: 사용자가 모든 정보를 알 필요 없이 최소한의 데이터로도 예측을 수행할 수 있어야 함

#### 📋 필수 vs 선택적 데이터 구분

- **필수 데이터**: 정원(capacity), 지원자 등급, 최소 2년 과거 데이터
- **선택적 데이터**: 경쟁률, 추가충원, 지원자 분포 특성 등
- **자동 추정**: 선택적 데이터가 없을 때 과거 패턴으로 자동 추정

#### 🔧 자동 추정 로직 구현 시 주의사항

1. **과거 데이터 품질 검증**: 극단값이나 이상치가 있는지 확인
2. **추정 신뢰도 표시**: 자동 추정된 값임을 사용자에게 명시
3. **폴백 메커니즘**: 추정이 불가능한 경우 적절한 기본값 사용
4. **사용자 경험**: 추정 과정을 투명하게 보여주고 조정 가능하게 함

### 테스트 작성

- 모든 새로운 기능에 대한 테스트 작성
- 기존 테스트가 모두 통과하는지 확인
- 테스트 커버리지 유지

#### 🧪 부분적 데이터 입력 테스트 필수 사항

1. **최소 데이터 테스트**: 필수값만으로 예측 실행 가능성 검증
2. **자동 추정 테스트**: 경쟁률/추가충원 자동 추정 정확성 검증
3. **피팅 모드 분기 테스트**: 데이터 상황별 최적 모드 선택 검증
4. **에러 핸들링 테스트**: 부족한 데이터로 인한 예외 상황 처리
5. **사용자 경험 테스트**: 자동 추정 과정의 투명성과 조정 가능성

#### 🧪 명시적 입력 상태 제어 테스트 필수 사항 (v6.2.1+)

1. **입력 상태 초기화 테스트**: 초기 상태가 모두 False인지 확인
2. **입력 상태 토글 테스트**: 체크박스로 상태 변경이 올바르게 되는지 확인
3. **필드 활성화/비활성화 테스트**: 체크박스 상태에 따른 UI 변경 확인
4. **값 전달 로직 테스트**: 입력 상태에 따른 값 전달 정확성 확인
5. **JSON 저장/복원 테스트**: 입력 상태 정보가 프로필에 올바르게 저장/복원되는지 확인
6. **하위 호환성 테스트**: 기존 프로필 파일과의 호환성 확인
7. **엣지 케이스 테스트**: 입력 상태가 None이거나 없는 경우 처리 확인
8. **자동 추정 트리거 테스트**: 입력 상태가 False일 때 자동 추정이 올바르게 트리거되는지 확인
9. **사용자 입력 보존 테스트**: 입력 상태가 True일 때 0을 포함한 모든 값이 보존되는지 확인

```bash
# 테스트 실행
pytest tests/ -v

# 커버리지 확인
pytest tests/ --cov=src/ --cov-report=html
```

### 커밋 메시지 규칙

```
type(scope): description

feat: 새로운 기능
fix: 버그 수정
docs: 문서 수정
style: 코드 스타일 변경
refactor: 코드 리팩토링
test: 테스트 추가/수정
chore: 빌드 프로세스 또는 보조 도구 변경
```

## 📋 Pull Request 프로세스

### 1. 변경사항 준비

- 코드 변경
- 테스트 작성 및 실행
- 문서 업데이트 (필요시)

### 2. PR 생성

- 명확한 제목과 설명
- 변경사항 요약
- 테스트 결과 포함
- 스크린샷 (UI 변경시)

### 3. 코드 리뷰

- 리뷰어의 피드백 반영
- CI/CD 체크 통과 확인

### 4. 머지

- 승인 후 `main` 브랜치로 머지

## 🐛 버그 리포트

버그를 발견하셨다면:

1. **이슈 검색**: 이미 보고된 버그인지 확인
2. **새 이슈 생성**: 명확한 제목과 설명
3. **재현 단계**: 버그 재현 방법 상세 설명
4. **환경 정보**: OS, Python 버전, 브라우저 등

## 💡 기능 제안

새로운 기능을 제안하고 싶다면:

1. **이슈 생성**: 기능 제안 이슈
2. **사용 사례**: 구체적인 사용 시나리오
3. **구현 방향**: 구현 아이디어 제시
4. **우선순위**: 기능의 중요도 설명

## 🔧 개발 환경 설정

### 필수 도구

- Python 3.10+
- Git
- pip

### 권장 도구

- VS Code 또는 PyCharm
- pre-commit hooks
- Docker (선택사항)

### pre-commit 설정

```bash
pip install pre-commit
pre-commit install
```

## 📚 문서화

### 코드 주석

- 복잡한 로직에 대한 설명
- 함수/클래스 docstring
- 중요한 수식이나 알고리즘 설명

### README 업데이트

- 새로운 기능 설명
- 사용법 예시
- 스크린샷 추가

### CHANGELOG

- 모든 변경사항 기록
- Semantic Versioning 준수

## 🚨 문제 해결

### 일반적인 문제들

#### 테스트 실패

```bash
# 의존성 재설치
pip install -r requirements.txt --force-reinstall

# 캐시 정리
pytest --cache-clear
```

#### Streamlit 실행 오류

```bash
# 포트 충돌 확인
netstat -an | findstr :8501

# 다른 포트 사용
streamlit run app.py --server.port 8502
```

#### Import 오류

```bash
# Python 경로 확인
python -c "import sys; print(sys.path)"

# 가상환경 활성화 확인
which python  # Unix
where python  # Windows
```

## 📞 도움 요청

문제가 해결되지 않는다면:

1. **이슈 검색**: 유사한 문제 해결 방법 확인
2. **Discussions**: GitHub Discussions에서 질문
3. **이슈 생성**: 구체적인 오류 메시지와 함께

## 🎯 기여 영역

### 우선순위 높음

- **버그 수정**: 예측 정확도, UI 오류, 데이터 처리 문제
- **성능 최적화**: 대용량 데이터 처리, 시뮬레이션 속도 개선
- **사용자 경험**: UI/UX 개선, 오류 메시지 명확화
- **부분적 데이터 입력**: 자동 추정 로직 정확도 향상
- **명시적 입력 상태 제어**: 체크박스 시스템 안정성 및 사용성 개선
- **UI 레이아웃 최적화**: 공간 효율성과 가독성 균형 개선

### 우선순위 중간

- **테스트 커버리지**: 새로운 기능에 대한 테스트 케이스 추가
- **문서화**: README, API 문서, 사용자 가이드 업데이트
- **코드 품질**: 리팩토링, 타입 힌트 추가, 주석 개선
- **자동 추정 시스템**: 더 정교한 통계적 모델링
- **입력 검증**: 사용자 입력 데이터 유효성 검사 강화
- **반응형 디자인**: 다양한 화면 크기에서의 UI 최적화

### 우선순위 낮음

- **새로운 기능**: 추가 분석 도구, 데이터 시각화 옵션
- **국제화**: 다국어 지원, 지역별 데이터 형식
- **고급 통계**: 추가 통계적 분석 방법론
- **API 확장**: 외부 시스템 연동 인터페이스

## 📄 라이선스

이 프로젝트는 MIT 라이선스 하에 배포됩니다. 기여하시는 모든 코드는 동일한 라이선스를 따릅니다.

---

**감사합니다!** 🎉

프로젝트에 기여해주셔서 정말 감사합니다. 함께 더 나은 수시 합격 가능성 예측기를 만들어가요!
